<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Free Online Image Resizer | Resize & Compress JPG, PNG, WebP</title>
    <meta name="description" content="Resize and optimize your images online for free. Adjust dimensions (width, height), maintain aspect ratio, choose output format (JPG, PNG, WebP), and control compression quality. Fast and easy!">
    <meta name="keywords" content="image resizer, resize image, photo resizer, online image resizer, change image size, compress image, jpg resizer, png resizer, webp resizer, free tool">
    <link rel="canonical" href="https://www.yourwebsite.com/image-resizer">

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#4a90e2">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="theme-color" content="#ffffff">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-YOUR_ADSENSE_PUBLISHER_ID"
         crossorigin="anonymous"></script>

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Online Image Resizer",
      "description": "Free online tool to resize images, adjust dimensions, maintain aspect ratio, choose format, and control compression quality.",
      "applicationCategory": "DesignApplication",
      "operatingSystem": "Any",
      "browserRequirements": "Requires JavaScript and HTML5 Canvas support.",
      "url": "https://www.yourwebsite.com/image-resizer" // Replace with your actual URL
    }
    </script>

    <style>
        /* --- Base Styles & Variables --- */
        :root {
            --primary-color: #4A90E2; /* Refined Blue */
            --primary-dark: #3A7BC8;
            --secondary-color: #50E3C2; /* Teal Accent */
            --dark-color: #2c3e50; /* Darker Slate Blue */
            --light-color: #f8f9fa; /* Very Light Gray */
            --gray-color: #7f8c8d; /* Medium Gray */
            --light-gray-color: #ecf0f1; /* Lighter Gray */
            --border-color: #bdc3c7; /* Soft Gray Border */
            --success-color: #27ae60; /* Green */
            --error-color: #c0392b; /* Red */
            --bg-color: #ffffff;
            --text-color: var(--dark-color);
            --font-family: 'Poppins', sans-serif;
            --border-radius: 8px; /* Slightly larger radius */
            --box-shadow: 0 5px 20px rgba(44, 62, 80, 0.1); /* Softer shadow */
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); /* Smooth transition */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--font-family);
            line-height: 1.7; /* Slightly increased line height */
            color: var(--text-color);
            background-color: var(--light-color);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            font-size: 16px; /* Base font size */
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        h1, h2, h3 {
            color: var(--dark-color);
            margin-bottom: 0.75em;
            line-height: 1.3;
        }

        h1 { font-size: clamp(1.8rem, 5vw, 2.5rem); font-weight: 700; } /* Responsive H1 */
        h2 { font-size: clamp(1.4rem, 4vw, 1.8rem); font-weight: 600; }
        h3 { font-size: clamp(1.1rem, 3vw, 1.3rem); font-weight: 600; }

        p { margin-bottom: 1.2em; }
        a { color: var(--primary-color); text-decoration: none; transition: var(--transition); }
        a:hover { color: var(--primary-dark); text-decoration: none; } /* Remove underline on hover */
        img { max-width: 100%; height: auto; display: block; }
        ul { list-style-position: outside; padding-left: 20px; margin-bottom: 1em; }
        ul li { margin-bottom: 0.5em; }

        /* --- Header & Footer --- */
        .header {
            background-color: var(--bg-color);
            padding: 1rem 0;
            box-shadow: 0 3px 10px rgba(44, 62, 80, 0.05);
            border-bottom: 1px solid var(--light-gray-color);
            position: sticky; /* Make header sticky */
            top: 0;
            z-index: 1000;
        }

        .logo {
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--primary-color);
            text-decoration: none;
        }
        .logo:hover { text-decoration: none; color: var(--primary-dark); }

        .footer {
            background-color: var(--dark-color);
            color: var(--light-gray-color);
            padding: 2rem 0;
            text-align: center;
            margin-top: auto; /* Push footer to bottom */
            font-size: 0.9rem;
        }
        .footer a { color: var(--secondary-color); font-weight: 500; }
        .footer a:hover { color: var(--light-color); }

        /* --- Main Content & Tool Section --- */
        .main-content {
            padding: 2.5rem 0;
            flex-grow: 1;
        }

        .tool-section {
            background-color: var(--bg-color);
            padding: clamp(1.5rem, 5vw, 3rem); /* Responsive padding */
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: 2.5rem;
        }
        .tool-section > h1 { text-align: center; margin-bottom: 0.5em;}
        .subtitle {
            text-align: center;
            color: var(--gray-color);
            margin-bottom: 3rem;
            font-size: clamp(1rem, 3vw, 1.15rem);
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }

        .resizer-wrapper {
            display: grid; /* Use Grid for more control */
            grid-template-columns: repeat(auto-fit, minmax(min(100%, 300px), 1fr)); /* Responsive columns */
            gap: 3rem; /* Increased gap */
        }

        .column { /* Grid items replace flex columns */
            min-width: 0; /* Allow grid items to shrink */
        }

        /* Optional: Add border back for larger screens if desired */
        /* @media (min-width: 769px) {
            .column-left { border-right: 1px solid var(--border-color); padding-right: 3rem; }
        } */


        /* --- File Input & Preview --- */
        .file-drop-area {
            border: 3px dashed var(--light-gray-color); /* Lighter dash */
            border-radius: var(--border-radius);
            padding: clamp(1.5rem, 5vw, 2.5rem);
            text-align: center;
            background-color: var(--light-color); /* Slightly off-white background */
            transition: all 0.3s ease;
            margin-bottom: 2rem;
            cursor: pointer;
            position: relative; /* For pseudo-elements if needed */
        }

        .file-drop-area:hover,
        .file-drop-area.dragover {
            background-color: #e9f2ff;
            border-color: var(--primary-color);
        }

        .file-drop-area .icon-upload {
            font-size: clamp(2.5rem, 8vw, 3.5rem);
            color: var(--primary-color);
            margin-bottom: 0.75rem;
            transition: transform 0.3s ease;
        }
        .file-drop-area:hover .icon-upload {
            transform: scale(1.1) translateY(-5px);
        }

        .file-drop-area .drop-text {
            font-weight: 600;
            color: var(--dark-color);
            font-size: 1.1em;
            margin-bottom: 0.25em;
        }

        .file-drop-area p {
            color: var(--gray-color);
            margin-bottom: 0.75rem;
            font-size: 0.95rem;
        }

        .image-preview-container {
            margin-top: 2rem;
            text-align: center;
        }
        .image-preview-container img {
            max-height: 300px; /* Increased max height */
            margin: 0 auto 0.75rem auto;
            border: 1px solid var(--border-color);
            padding: 6px;
            border-radius: var(--border-radius);
            background-color: var(--light-gray-color);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        #originalFileInfo {
            font-size: 0.9rem;
            color: var(--gray-color);
        }

        .error-message {
            color: var(--error-color);
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: var(--border-radius);
            padding: 0.75rem 1.25rem;
            margin-top: 1.5rem;
            text-align: center;
            font-weight: 500;
            display: none; /* Hidden by default */
        }
        .error-message.show {
             display: block;
        }

        /* --- Options --- */
        .options-grid { /* Nested grid for dimension inputs */
             display: grid;
             grid-template-columns: 1fr 1fr;
             gap: 1rem;
             align-items: center;
             margin-bottom: 0.75rem;
        }
        .options-group {
            margin-bottom: 1.75rem; /* Increased spacing */
        }
        .options-group label {
            display: block;
            margin-bottom: 0.6rem;
            font-weight: 600; /* Bolder labels */
            font-size: 1rem;
            color: var(--dark-color);
        }
         .options-group small {
            display: block;
            margin-top: 0.5rem;
            font-size: 0.85rem;
            color: var(--gray-color);
        }

        /* Input fields styling */
        .input-css, .select-css {
            width: 100%;
            padding: 0.8rem 1rem; /* Comfortable padding */
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-family: var(--font-family);
            background-color: #fff;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .input-css:focus, .select-css:focus {
             outline: none;
             border-color: var(--primary-color);
             box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.2);
        }

        .select-css {
            appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%20fill%3D%22%232c3e50%22%3E%3Cpath%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right .9em top 50%;
            background-size: .7em auto;
            padding-right: 2.8em;
        }

        /* Checkbox styling */
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-top: 0.5rem; /* Adjust spacing for checkbox */
            margin-bottom: 1.5rem;
        }
        .checkbox-group label {
             margin-bottom: 0; /* Remove bottom margin */
             font-weight: 500;
             font-size: 0.95rem;
             cursor: pointer;
             color: var(--gray-color); /* Lighter label */
        }
        .checkbox-css {
             width: 1.3em;
             height: 1.3em;
             accent-color: var(--primary-color); /* Modern way to color checkbox */
             cursor: pointer;
        }

        /* Slider Customization */
        .slider-css {
            -webkit-appearance: none; appearance: none;
            width: 100%; height: 10px; /* Slightly thicker */
            background: var(--light-gray-color);
            outline: none; opacity: 0.9;
            transition: opacity .2s; border-radius: 5px;
            cursor: pointer; padding: 0; margin-top: 0.5rem;
        }
        .slider-css:hover { opacity: 1; }
        .slider-css::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none;
            width: 22px; height: 22px; /* Larger thumb */
            background: var(--primary-color); border-radius: 50%;
            cursor: pointer; transition: background-color 0.2s ease;
        }
        .slider-css::-moz-range-thumb {
            width: 22px; height: 22px; background: var(--primary-color);
            border-radius: 50%; cursor: pointer; border: none;
            transition: background-color 0.2s ease;
        }
         .slider-css:active::-webkit-slider-thumb,
         .slider-css:active::-moz-range-thumb {
             background-color: var(--primary-dark);
         }

        /* Buttons */
        .btn {
            display: inline-flex; /* Use inline-flex for icon alignment */
            align-items: center;
            justify-content: center;
            gap: 0.6em;
            padding: 0.9rem 1.8rem; /* Generous padding */
            font-size: 1rem;
            font-weight: 600; /* Bold button text */
            text-align: center;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            margin-right: 0.5rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); /* Subtle button shadow */
            text-decoration: none !important; /* Ensure no underline */
        }
        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }
        .btn:active:not(:disabled) {
             transform: translateY(0px);
             box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; }

        .btn-primary { background-color: var(--primary-color); color: #fff; }
        .btn-primary:hover:not(:disabled) { background-color: var(--primary-dark); }

        .btn-resize {
            background: linear-gradient(135deg, var(--secondary-color), #2ecc71); /* Gradient button */
            color: var(--bg-color);
            width: 100%;
            margin-top: 1.5rem;
            font-weight: 700;
            letter-spacing: 0.5px;
            padding: 1rem 1.8rem; /* Larger main action button */
        }
        .btn-resize:hover:not(:disabled) { background: linear-gradient(135deg, #45ccb0, #27ae60); }

        .btn-success {
            background-color: var(--success-color);
            color: #fff;
            width: 100%;
        }
        .btn-success:hover:not(:disabled) { background-color: #218838; }


        /* Output Section */
        .output-section {
            margin-top: 2.5rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border-color);
            text-align: center; /* Center download button */
        }
        #outputFileInfo {
            font-size: 0.95rem;
            color: var(--gray-color);
            margin-bottom: 1.5rem;
        }
        #downloadLink { width: auto; /* Don't force full width */ display: inline-flex; } /* Center button properly */

        /* Loading Spinner */
        .icon-spin { animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Ad Spaces */
        .ad-space {
            background-color: var(--light-gray-color);
            border: 1px dashed var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 2.5rem auto;
            overflow: hidden;
            min-width: 100px; min-height: 50px;
            padding: 10px; /* Padding for placeholder */
        }
        .ad-banner-top { min-height: 90px; width: 100%; max-width: 728px; }
        .ad-inline { min-height: 250px; width: 100%; max-width: 300px; margin-top: 2rem; }
        .ad-placeholder-text { color: var(--gray-color); font-size: 0.9rem; margin: 0; }

        .adsbygoogle[data-ad-status="filled"] { background-color: transparent !important; border: none !important; }
        .adsbygoogle[data-ad-status="filled"] + .ad-placeholder-text,
        .adsbygoogle[data-ad-status="filled"] ~ .ad-placeholder-text { display: none; }
        .adsbygoogle:not([data-ad-status="filled"]) { background-color: var(--light-gray-color); }
        ins.adsbygoogle { display: block; text-align: center; background: transparent; }

        /* Info Content */
        .info-content {
            background-color: var(--bg-color);
            padding: clamp(1.5rem, 5vw, 3rem);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-top: 3rem;
        }
        .info-content h2 { border-bottom: 2px solid var(--primary-light); padding-bottom: 0.5em; }

        /* Responsive Adjustments */
        @media (max-width: 768px) {
            .resizer-wrapper { gap: 2rem; } /* Adjust gap */
            .options-grid { grid-template-columns: 1fr; } /* Stack dimension inputs */
        }

        @media (max-width: 576px) {
            .main-content { padding: 1.5rem 0; }
            .tool-section { padding: 1.5rem; }
            .subtitle { margin-bottom: 2rem; }
            .file-drop-area { padding: 1.5rem; }
            .ad-inline { max-width: 100%; min-height: 100px; }
            .btn { padding: 0.8rem 1.5rem; font-size: 0.95rem; }
            .btn-resize, .btn-success { padding: 0.9rem 1.5rem; }
            .footer { padding: 1.5rem 0; }
        }
    </style>

</head>
<body>

    <header class="header">
        <div class="container">
            <a href="#" class="logo">ResizeMaster</a>
        </div>
    </header>

    <main class="main-content">
        <div class="container">

            <section class="ad-space ad-banner-top">
                <ins class="adsbygoogle"
                     style="display:block"
                     data-ad-client="ca-pub-YOUR_ADSENSE_PUBLISHER_ID" data-ad-slot="YOUR_AD_SLOT_ID_1" data-ad-format="auto"
                     data-full-width-responsive="true"></ins>
                 <p class="ad-placeholder-text">Top Banner Advertisement</p> <script>
                     try { (adsbygoogle = window.adsbygoogle || []).push({}); } catch (e) { console.error("AdSense Top Banner error:", e); }
                </script>
            </section>

            <section class="tool-section">
                <h1>Online Image Resizer & Optimizer</h1>
                <p class="subtitle">Quickly resize your images by pixel dimensions. Adjust format and quality for optimized results, right in your browser.</p>

                <div class="resizer-wrapper">
                    <div class="column column-left">
                        <h2>1. Upload Your Image</h2>
                        <div class="file-drop-area" id="fileDropArea">
                            <i class="fas fa-image icon-upload"></i>
                            <p class="drop-text">Drag & drop image here</p>
                            <p>or</p>
                            <label for="fileInput" class="btn btn-primary">Browse Files</label>
                            <input type="file" id="fileInput" accept="image/jpeg, image/png, image/gif, image/bmp, image/webp" hidden>
                        </div>
                        <div id="imagePreviewContainer" class="image-preview-container" style="display: none;">
                             <h3>Original Preview:</h3>
                            <img id="imagePreview" src="#" alt="Original Image Preview">
                            <p id="originalFileInfo"></p>
                        </div>
                         <div id="errorMessage" class="error-message" role="alert"></div>
                    </div>

                    <div class="column column-right">
                        <h2>2. Set Resize Options</h2>

                        <div class="options-grid">
                            <div class="options-group">
                                <label for="widthInput">Width (px):</label>
                                <input type="number" id="widthInput" class="input-css" placeholder="e.g., 1920" min="1">
                            </div>
                            <div class="options-group">
                                <label for="heightInput">Height (px):</label>
                                <input type="number" id="heightInput" class="input-css" placeholder="e.g., 1080" min="1">
                            </div>
                        </div>
                         <div class="checkbox-group">
                             <input type="checkbox" id="aspectRatioLock" class="checkbox-css" checked>
                             <label for="aspectRatioLock">Maintain aspect ratio</label>
                         </div>

                        <h2>3. Choose Output Settings</h2>
                        <div class="options-group">
                            <label for="outputFormat">Output format:</label>
                            <select id="outputFormat" class="select-css">
                                <option value="image/jpeg">JPG</option>
                                <option value="image/png">PNG</option>
                                <option value="image/webp">WebP</option>
                            </select>
                        </div>

                        <div class="options-group" id="qualityGroup">
                            <label for="qualitySlider">Quality: <span id="qualityValue">90</span>%</label>
                            <input type="range" id="qualitySlider" min="0" max="100" value="90" class="slider-css">
                            <small>(For JPG/WebP formats. Lower quality = smaller file)</small>
                        </div>

                        <button id="resizeBtn" class="btn btn-resize" disabled>
                            <i class="fas fa-sync-alt icon-spin" style="display: none;"></i>
                            <i class="fas fa-crop-alt icon-resize"></i> Resize Image
                        </button>

                        <div id="outputSection" class="output-section" style="display: none;">
                            <h2>4. Download Result</h2>
                            <p id="outputFileInfo"></p>
                            <a id="downloadLink" href="#" download="resized_image.jpg" class="btn btn-success">
                                <i class="fas fa-download"></i> Download Resized Image
                            </a>
                        </div>

                         <section class="ad-space ad-inline">
                            <ins class="adsbygoogle"
                                 style="display:block"
                                 data-ad-client="ca-pub-YOUR_ADSENSE_PUBLISHER_ID" data-ad-slot="YOUR_AD_SLOT_ID_2" data-ad-format="auto"
                                 data-full-width-responsive="true"></ins>
                             <p class="ad-placeholder-text">Advertisement</p> <script>
                                 try { (adsbygoogle = window.adsbygoogle || []).push({}); } catch (e) { console.error("AdSense Inline error:", e); }
                            </script>
                        </section>
                     </div>
                 </div>
             </section>

             <section class="info-content">
                 <h2>How the Image Resizer Works</h2>
                 <p>This tool utilizes your web browser's built-in capabilities to resize images locally on your device. Upload an image, specify the desired width and/or height, choose whether to maintain the original aspect ratio, select an output format (JPG, PNG, WebP), and adjust the quality for JPG/WebP if needed. Click "Resize Image," and the tool will generate a new image ready for download. No files are uploaded to any server, ensuring your privacy.</p>

                 <h2>Why Resize Images?</h2>
                 <ul>
                     <li><strong>Websites & Blogs:</strong> Ensure faster page loads and consistent layouts by resizing images to appropriate dimensions before uploading.</li>
                     <li><strong>Social Media:</strong> Meet the specific size requirements for platforms like Instagram, Facebook, Twitter, etc.</li>
                     <li><strong>Email:</strong> Reduce attachment sizes for quicker sending and to avoid mailbox limits.</li>
                     <li><strong>Storage Space:</strong> Save device or cloud storage by reducing the dimensions and file size of large photos.</li>
                 </ul>

                 <h2>Tips for Best Results</h2>
                 <ul>
                     <li>For web use, consider WebP format for good quality and small file sizes, or JPG for photos (adjust quality). Use PNG for images requiring transparency.</li>
                     <li>Resizing images significantly larger can result in quality loss. It's generally best to resize downwards.</li>
                     <li>Always keep a copy of your original high-resolution image.</li>
                 </ul>
                 </section>

         </div>
     </main>

     <footer class="footer">
         <div class="container">
             <p>&copy; <span id="currentYear">2025</span> ResizeMaster. All rights reserved.</p>
             </div>
     </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM Elements ---
            const fileInput = document.getElementById('fileInput');
            const fileDropArea = document.getElementById('fileDropArea');
            const imagePreviewContainer = document.getElementById('imagePreviewContainer');
            const imagePreview = document.getElementById('imagePreview');
            const originalFileInfo = document.getElementById('originalFileInfo');
            const errorMessage = document.getElementById('errorMessage');

            const widthInput = document.getElementById('widthInput');
            const heightInput = document.getElementById('heightInput');
            const aspectRatioLock = document.getElementById('aspectRatioLock');

            const outputFormatSelect = document.getElementById('outputFormat');
            const qualityGroup = document.getElementById('qualityGroup');
            const qualitySlider = document.getElementById('qualitySlider');
            const qualityValueSpan = document.getElementById('qualityValue');

            const resizeBtn = document.getElementById('resizeBtn');
            const resizeBtnSpinner = resizeBtn.querySelector('.icon-spin');
            const resizeBtnIcon = resizeBtn.querySelector('.icon-resize'); // Static icon
            const outputSection = document.getElementById('outputSection');
            const outputFileInfo = document.getElementById('outputFileInfo');
            const downloadLink = document.getElementById('downloadLink');

            const currentYearSpan = document.getElementById('currentYear');

            // --- State ---
            let currentFile = null;
            let originalFileName = '';
            let originalFileType = '';
            let originalFileSize = 0;
            let originalWidth = 0;
            let originalHeight = 0;
            let aspectRatio = 1;
            let imagePreviewSrc = null; // Store the data URL

            // --- Functions ---

            // Format file size
            function formatFileSize(bytes, decimals = 2) {
                if (!+bytes) return '0 Bytes'; // Handles 0, null, undefined etc.
                const k = 1024;
                const dm = decimals < 0 ? 0 : decimals;
                const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                const index = Math.min(i, sizes.length - 1);
                return `${parseFloat((bytes / Math.pow(k, index)).toFixed(dm))} ${sizes[index]}`;
            }

            // Show error message
            function showError(message) {
                errorMessage.textContent = message;
                errorMessage.classList.add('show'); // Show error message
                // Hide preview if error occurs after upload
                if (imagePreviewContainer) imagePreviewContainer.style.display = 'none';
                resizeBtn.disabled = true;
            }

            // Clear error messages
            function clearError() {
                errorMessage.textContent = '';
                 errorMessage.classList.remove('show');
            }

            // Reset tool state
            function resetTool(clearInput = true) {
                currentFile = null;
                originalFileName = '';
                originalFileType = '';
                originalFileSize = 0;
                originalWidth = 0;
                originalHeight = 0;
                aspectRatio = 1;
                imagePreviewSrc = null;

                if (clearInput) fileInput.value = ''; // Clear file input only if specified

                imagePreviewContainer.style.display = 'none';
                imagePreview.src = '#';
                originalFileInfo.textContent = '';
                widthInput.value = '';
                heightInput.value = '';
                resizeBtn.disabled = true;
                outputSection.style.display = 'none';
                clearError();

                // Reset output options to default
                outputFormatSelect.value = 'image/jpeg';
                qualitySlider.value = 90;
                qualityValueSpan.textContent = '90';
                aspectRatioLock.checked = true;
                updateQualityControlVisibility();
            }

            // Display image preview and gather info
            function displayPreview(file) {
                 // Basic validation
                 if (!file.type.startsWith('image/')) {
                     showError('Invalid file type. Please upload an image (JPEG, PNG, GIF, WEBP, BMP).');
                     resetTool();
                     return;
                 }
                 const maxSize = 20 * 1024 * 1024; // 20 MB limit
                 if (file.size > maxSize) {
                     showError(`File is too large (${formatFileSize(file.size)}). Maximum size is ${formatFileSize(maxSize)}.`);
                     resetTool();
                     return;
                 }

                 clearError();
                const reader = new FileReader();

                reader.onload = (e) => {
                    imagePreviewSrc = e.target.result; // Store data URL
                    imagePreview.src = imagePreviewSrc;

                    // Get dimensions AFTER image is loaded into the preview element
                    imagePreview.onload = () => {
                        originalWidth = imagePreview.naturalWidth;
                        originalHeight = imagePreview.naturalHeight;
                        aspectRatio = originalWidth / originalHeight;

                        // Populate inputs and info
                        widthInput.value = originalWidth;
                        heightInput.value = originalHeight;
                        originalFileName = file.name;
                        originalFileType = file.type;
                        originalFileSize = file.size;
                        originalFileInfo.textContent = `Original: ${originalWidth}x${originalHeight}px (${formatFileSize(originalFileSize)})`;

                        imagePreviewContainer.style.display = 'block';
                        resizeBtn.disabled = false; // Enable resize button
                        outputSection.style.display = 'none'; // Hide previous output
                        updateQualityControlVisibility(); // Update controls based on default format
                        updateDownloadLinkAttributes(); // Set initial download name
                    };
                     imagePreview.onerror = () => {
                         showError("Could not load image preview. File might be corrupted.");
                         resetTool();
                     };
                };

                reader.onerror = () => {
                    showError('Error reading file.');
                    resetTool();
                };

                reader.readAsDataURL(file);
                currentFile = file;
            }

            // Update Width/Height based on Aspect Ratio Lock
            function updateDimensions(changedInput) {
                if (!aspectRatioLock.checked || !originalWidth || !originalHeight) return;

                const width = parseInt(widthInput.value, 10);
                const height = parseInt(heightInput.value, 10);

                if (changedInput === 'width' && width > 0) {
                    heightInput.value = Math.round(width / aspectRatio) || ''; // Avoid setting 0
                } else if (changedInput === 'height' && height > 0) {
                    widthInput.value = Math.round(height * aspectRatio) || ''; // Avoid setting 0
                }
            }

             // Update quality slider visibility
             function updateQualityControlVisibility() {
                const selectedFormat = outputFormatSelect.value;
                qualityGroup.style.display = (selectedFormat === 'image/png') ? 'none' : 'block';
                if (currentFile) updateDownloadLinkAttributes(); // Update filename hint
             }

             // Update download link attributes (name and type)
             function updateDownloadLinkAttributes() {
                 if (!originalFileName) return;

                 const targetWidth = widthInput.value || originalWidth;
                 const targetHeight = heightInput.value || originalHeight;
                 const selectedFormat = outputFormatSelect.value;
                 const quality = qualitySlider.value;
                 const baseName = originalFileName.split('.').slice(0, -1).join('.') || 'resized';
                 let extension = selectedFormat.split('/')[1];
                 if (extension === 'jpeg') extension = 'jpg';

                 let downloadFilename = `${baseName}_${targetWidth}x${targetHeight}.${extension}`;
                 if (selectedFormat !== 'image/png') {
                     downloadFilename = `${baseName}_${targetWidth}x${targetHeight}_q${quality}.${extension}`;
                 }
                 downloadLink.download = downloadFilename;
             }


            // Handle image resizing and conversion
            function resizeImage() {
                if (!currentFile || !imagePreviewSrc) {
                    showError('Please upload an image first.');
                    return;
                }

                const targetWidth = parseInt(widthInput.value, 10);
                const targetHeight = parseInt(heightInput.value, 10);

                if (!targetWidth || targetWidth <= 0 || !targetHeight || targetHeight <= 0) {
                    showError('Please enter valid positive dimensions (Width and Height).');
                    return;
                }

                resizeBtn.disabled = true;
                resizeBtnSpinner.style.display = 'inline-block';
                resizeBtnIcon.style.display = 'none'; // Hide static icon
                clearError();
                outputSection.style.display = 'none';

                const img = new Image();
                img.onload = () => {
                    // Optional: Check again for very large target dimensions if needed
                    const MAX_CANVAS_AREA = 32 * 1024 * 1024; // Example: 32 Megapixels
                    if (targetWidth * targetHeight > MAX_CANVAS_AREA) {
                         showError(`Target dimensions (${targetWidth}x${targetHeight}) might be too large for reliable browser processing.`);
                         resizeBtn.disabled = false;
                         resizeBtnSpinner.style.display = 'none';
                         resizeBtnIcon.style.display = 'inline-block'; // Show static icon
                         return;
                    }

                    const canvas = document.createElement('canvas');
                    canvas.width = targetWidth;
                    canvas.height = targetHeight;
                    const ctx = canvas.getContext('2d');

                    // Draw Image (Simple scaling - consider Pica library for higher quality downscaling if needed)
                    // For better quality: ctx.imageSmoothingQuality = 'high'; (experiment)
                    ctx.drawImage(img, 0, 0, targetWidth, targetHeight);

                    const outputFormat = outputFormatSelect.value;
                    let quality = 1.0;
                    if (outputFormat !== 'image/png') {
                        quality = parseInt(qualitySlider.value, 10) / 100;
                    }

                    try {
                        const dataUrl = canvas.toDataURL(outputFormat, quality);
                         if (!dataUrl || dataUrl === "data:,") {
                             throw new Error("Canvas generated empty or invalid data URL.");
                         }

                        // Estimate size (approximate)
                        const head = 'data:' + outputFormat + ';base64,';
                        const approxBytes = Math.round((dataUrl.length - head.length) * 3 / 4);

                        outputFileInfo.textContent = `Resized: ${targetWidth}x${targetHeight}px, ~${formatFileSize(approxBytes)}`;
                        downloadLink.href = dataUrl;
                        updateDownloadLinkAttributes(); // Update download name finally

                        outputSection.style.display = 'block';

                    } catch (error) {
                        console.error("Canvas conversion error:", error);
                        showError(`Resizing failed. The format/dimensions might not be supported or the image is too complex. Error: ${error.message}`);
                    } finally {
                        resizeBtn.disabled = false;
                        resizeBtnSpinner.style.display = 'none';
                        resizeBtnIcon.style.display = 'inline-block'; // Show static icon
                    }
                };

                img.onerror = () => {
                    showError('Could not load image data for resizing. The file might be corrupted.');
                    resizeBtn.disabled = false;
                    resizeBtnSpinner.style.display = 'none';
                    resizeBtnIcon.style.display = 'inline-block';
                };
                img.src = imagePreviewSrc; // Use the stored data URL
            }


            // --- Event Listeners ---

            // File Input Change
            fileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    displayPreview(file);
                } else {
                    resetTool(false); // Don't clear the input value if selection was cancelled
                }
            });

            // Drag and Drop
            fileDropArea.addEventListener('dragover', (e) => { e.preventDefault(); fileDropArea.classList.add('dragover'); });
            fileDropArea.addEventListener('dragleave', (e) => { e.preventDefault(); fileDropArea.classList.remove('dragover'); });
            fileDropArea.addEventListener('drop', (e) => {
                e.preventDefault();
                fileDropArea.classList.remove('dragover');
                const file = e.dataTransfer.files[0];
                if (file) {
                     try {
                        const dataTransfer = new DataTransfer();
                        dataTransfer.items.add(file);
                        fileInput.files = dataTransfer.files;
                        fileInput.dispatchEvent(new Event('change', { bubbles: true }));
                     } catch (err) {
                         console.error("Error handling dropped file:", err);
                         displayPreview(file); // Fallback
                     }
                }
            });
            // Trigger file input click
            fileDropArea.addEventListener('click', (e) => {
                 if (e.target === fileDropArea || e.target.classList.contains('icon-upload') || e.target.classList.contains('drop-text') || e.target.tagName === 'P' ) {
                     fileInput.click();
                 }
            });

            // Dimension Input Changes
            widthInput.addEventListener('input', () => updateDimensions('width'));
            heightInput.addEventListener('input', () => updateDimensions('height'));

            // Aspect Ratio Lock Change
            aspectRatioLock.addEventListener('change', () => {
                 // If locked, recalculate based on width (or height if width is empty)
                 if(aspectRatioLock.checked && currentFile) {
                     if(widthInput.value) updateDimensions('width');
                     else if(heightInput.value) updateDimensions('height');
                 }
            });

            // Quality Slider Input
            qualitySlider.addEventListener('input', (e) => {
                qualityValueSpan.textContent = e.target.value;
                if (currentFile) updateDownloadLinkAttributes(); // Update download name hint
            });

            // Output Format Change
            outputFormatSelect.addEventListener('change', updateQualityControlVisibility);

            // Resize Button Click
            resizeBtn.addEventListener('click', resizeImage);

            // Set current year in footer
            if (currentYearSpan) {
                currentYearSpan.textContent = new Date().getFullYear();
            }

            // --- Initial Setup ---
            resetTool(); // Initialize the tool state

        });
    </script>

</body>
</html>
